# å®¢æˆ·ç«¯-æœåŠ¡ç«¯æ¶æ„æ”¹é€ è¯¦ç»†æŒ‡å—

## ğŸ“‹ æ€»ä½“æ¶æ„è®¾è®¡

### æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         TCP Socket          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚   æœåŠ¡ç«¯    â”‚
â”‚  (Qt GUI)   â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ (Qt Server) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         JSON æ•°æ®           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                                      â–¼
                                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                              â”‚  MySQL æ•°æ®åº“â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é€šä¿¡åè®®è®¾è®¡
- **åè®®ç±»å‹**: TCP Socket
- **æ•°æ®æ ¼å¼**: JSON
- **ç«¯å£**: 8888ï¼ˆå¯è‡ªå®šä¹‰ï¼‰
- **ç¼–ç **: UTF-8

---

## ğŸ–¥ï¸ ç¬¬ä¸€éƒ¨åˆ†ï¼šæ­å»ºæœåŠ¡ç«¯

### æ­¥éª¤1ï¼šåˆ›å»ºæœåŠ¡ç«¯é¡¹ç›®

1. **åœ¨Qt Creatorä¸­åˆ›å»ºæ–°é¡¹ç›®**
   - é€‰æ‹© "Qt Console Application"ï¼ˆæ§åˆ¶å°åº”ç”¨ï¼‰
   - é¡¹ç›®åç§°ï¼š`FlightServer`
   - ä½ç½®ï¼šå»ºè®®æ”¾åœ¨ä¸å®¢æˆ·ç«¯é¡¹ç›®åŒçº§ç›®å½•
   - Qtç‰ˆæœ¬ï¼šé€‰æ‹©ä½ ç°æœ‰çš„Qtç‰ˆæœ¬ï¼ˆ6.9.2ï¼‰

2. **ä¿®æ”¹ .pro æ–‡ä»¶**
   åœ¨ `FlightServer.pro` ä¸­æ·»åŠ ä»¥ä¸‹æ¨¡å—ï¼š
   ```pro
   QT += core sql network
   CONFIG += c++17 console
   ```

### æ­¥éª¤2ï¼šè®¾è®¡é€šä¿¡åè®®

#### 2.1 å®šä¹‰æ¶ˆæ¯ç±»å‹ï¼ˆæšä¸¾ï¼‰
åˆ›å»º `protocol.h` æ–‡ä»¶ï¼Œå®šä¹‰æ‰€æœ‰æ¶ˆæ¯ç±»å‹ï¼š

```cpp
#ifndef PROTOCOL_H
#define PROTOCOL_H

enum MessageType {
    // ç”¨æˆ·ç›¸å…³
    MSG_LOGIN = 1001,           // ç™»å½•è¯·æ±‚
    MSG_LOGIN_RESPONSE = 1002,  // ç™»å½•å“åº”
    MSG_REGISTER = 1003,         // æ³¨å†Œè¯·æ±‚
    MSG_REGISTER_RESPONSE = 1004,// æ³¨å†Œå“åº”
    
    // ç¥¨åŠ¡æŸ¥è¯¢
    MSG_SEARCH_TICKETS = 2001,  // æŸ¥è¯¢ç¥¨åŠ¡
    MSG_SEARCH_RESPONSE = 2002, // æŸ¥è¯¢å“åº”
    
    // è®¢å•ç›¸å…³
    MSG_CREATE_ORDER = 3001,    // åˆ›å»ºè®¢å•
    MSG_CREATE_ORDER_RESPONSE = 3002, // åˆ›å»ºè®¢å•å“åº”
    MSG_GET_ORDERS = 3003,      // è·å–è®¢å•åˆ—è¡¨
    MSG_GET_ORDERS_RESPONSE = 3004, // è®¢å•åˆ—è¡¨å“åº”
    MSG_CANCEL_ORDER = 3005,    // å–æ¶ˆè®¢å•
    MSG_CANCEL_ORDER_RESPONSE = 3006, // å–æ¶ˆè®¢å•å“åº”
    
    // æ”¶è—ç›¸å…³
    MSG_ADD_FAVORITE = 4001,    // æ·»åŠ æ”¶è—
    MSG_ADD_FAVORITE_RESPONSE = 4002,
    MSG_GET_FAVORITES = 4003,   // è·å–æ”¶è—åˆ—è¡¨
    MSG_GET_FAVORITES_RESPONSE = 4004,
    MSG_DELETE_FAVORITE = 4005, // åˆ é™¤æ”¶è—
    MSG_DELETE_FAVORITE_RESPONSE = 4006
};

#endif // PROTOCOL_H
```

#### 2.2 JSONæ¶ˆæ¯æ ¼å¼è®¾è®¡

**è¯·æ±‚æ¶ˆæ¯æ ¼å¼**ï¼š
```json
{
    "type": 1001,
    "data": {
        "username": "user123",
        "password": "pass123"
    }
}
```

**å“åº”æ¶ˆæ¯æ ¼å¼**ï¼š
```json
{
    "type": 1002,
    "success": true,
    "message": "ç™»å½•æˆåŠŸ",
    "data": {
        "userID": "123"
    }
}
```

**é”™è¯¯å“åº”æ ¼å¼**ï¼š
```json
{
    "type": 1002,
    "success": false,
    "message": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯",
    "data": null
}
```

### æ­¥éª¤3ï¼šåˆ›å»ºæœåŠ¡ç«¯ä¸»ç±»

#### 3.1 åˆ›å»º `server.h`
```cpp
#ifndef SERVER_H
#define SERVER_H

#include <QTcpServer>
#include <QTcpSocket>
#include <QList>
#include <QJsonDocument>
#include <QJsonObject>
#include <QSqlDatabase>
#include <QSqlQuery>

class Server : public QTcpServer
{
    Q_OBJECT

public:
    explicit Server(QObject *parent = nullptr);
    ~Server();

private slots:
    void newConnection();
    void clientDisconnected();
    void readClientData();

private:
    void initDatabase();
    void handleMessage(QTcpSocket *client, const QJsonObject &json);
    
    // æ¶ˆæ¯å¤„ç†å‡½æ•°
    void handleLogin(QTcpSocket *client, const QJsonObject &data);
    void handleRegister(QTcpSocket *client, const QJsonObject &data);
    void handleSearchTickets(QTcpSocket *client, const QJsonObject &data);
    void handleCreateOrder(QTcpSocket *client, const QJsonObject &data);
    void handleGetOrders(QTcpSocket *client, const QJsonObject &data);
    void handleCancelOrder(QTcpSocket *client, const QJsonObject &data);
    void handleAddFavorite(QTcpSocket *client, const QJsonObject &data);
    void handleGetFavorites(QTcpSocket *client, const QJsonObject &data);
    void handleDeleteFavorite(QTcpSocket *client, const QJsonObject &data);
    
    // å‘é€å“åº”
    void sendResponse(QTcpSocket *client, int msgType, bool success, 
                     const QString &message, const QJsonObject &data = QJsonObject());
    
    QList<QTcpSocket*> clients;
    QSqlDatabase db;
};

#endif // SERVER_H
```

#### 3.2 åˆ›å»º `server.cpp`ï¼ˆæ ¸å¿ƒå®ç°ï¼‰

**å…³é”®ç‚¹1ï¼šåˆå§‹åŒ–æ•°æ®åº“è¿æ¥**
```cpp
void Server::initDatabase()
{
    db = QSqlDatabase::addDatabase("QODBC");
    db.setConnectOptions("SQL_ATTR_ODBC_VERSION=SQL_OV_ODBC3");
    
    QString connectionString = "DRIVER={MySQL ODBC 9.5 Unicode Driver};"
                               "SERVER=127.0.0.1;"
                               "PORT=3306;"
                               "DATABASE=flight;"
                               "USER=root;"
                               "PASSWORD=@WUyh0601;"
                               "OPTION=3;";
    
    db.setDatabaseName(connectionString);
    
    if (!db.open()) {
        qDebug() << "æœåŠ¡ç«¯æ•°æ®åº“è¿æ¥å¤±è´¥ï¼š" << db.lastError().text();
    } else {
        qDebug() << "æœåŠ¡ç«¯æ•°æ®åº“è¿æ¥æˆåŠŸï¼";
    }
}
```

**å…³é”®ç‚¹2ï¼šå¤„ç†ç™»å½•è¯·æ±‚ç¤ºä¾‹**
```cpp
void Server::handleLogin(QTcpSocket *client, const QJsonObject &data)
{
    QString username = data["username"].toString();
    QString password = data["password"].toString();
    
    QSqlQuery query(db);
    query.prepare("SELECT UserID FROM users WHERE Username=? AND PWord=?");
    query.addBindValue(username);
    query.addBindValue(password);
    
    if (query.exec() && query.next()) {
        QString userID = query.value(0).toString();
        QJsonObject responseData;
        responseData["userID"] = userID;
        sendResponse(client, MSG_LOGIN_RESPONSE, true, "ç™»å½•æˆåŠŸ", responseData);
    } else {
        sendResponse(client, MSG_LOGIN_RESPONSE, false, "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
    }
}
```

**å…³é”®ç‚¹3ï¼šå‘é€å“åº”å‡½æ•°**
```cpp
void Server::sendResponse(QTcpSocket *client, int msgType, bool success,
                          const QString &message, const QJsonObject &data)
{
    QJsonObject response;
    response["type"] = msgType;
    response["success"] = success;
    response["message"] = message;
    response["data"] = data;
    
    QJsonDocument doc(response);
    QByteArray jsonData = doc.toJson(QJsonDocument::Compact);
    
    // æ·»åŠ é•¿åº¦å‰ç¼€ï¼ˆ4å­—èŠ‚ï¼‰ï¼Œæ–¹ä¾¿å®¢æˆ·ç«¯è¯»å–
    QByteArray packet;
    QDataStream stream(&packet, QIODevice::WriteOnly);
    stream << (quint32)jsonData.size();
    packet.append(jsonData);
    
    client->write(packet);
    client->flush();
}
```

**å…³é”®ç‚¹4ï¼šè¯»å–å®¢æˆ·ç«¯æ•°æ®ï¼ˆå¤„ç†ç²˜åŒ…ï¼‰**
```cpp
void Server::readClientData()
{
    QTcpSocket *client = qobject_cast<QTcpSocket*>(sender());
    if (!client) return;
    
    QDataStream in(client);
    in.setVersion(QDataStream::Qt_6_0);
    
    static QMap<QTcpSocket*, quint32> packetSizes;
    
    while (true) {
        if (packetSizes[client] == 0) {
            if (client->bytesAvailable() < sizeof(quint32)) {
                break; // æ•°æ®ä¸å¤Ÿï¼Œç­‰å¾…
            }
            in >> packetSizes[client];
        }
        
        if (client->bytesAvailable() < packetSizes[client]) {
            break; // æ•°æ®ä¸å®Œæ•´ï¼Œç­‰å¾…
        }
        
        QByteArray jsonData = client->read(packetSizes[client]);
        packetSizes[client] = 0; // é‡ç½®
        
        QJsonParseError error;
        QJsonDocument doc = QJsonDocument::fromJson(jsonData, &error);
        
        if (error.error == QJsonParseError::NoError && doc.isObject()) {
            handleMessage(client, doc.object());
        }
    }
}
```

### æ­¥éª¤4ï¼šåˆ›å»ºä¸»å‡½æ•° `main.cpp`

```cpp
#include "server.h"
#include <QCoreApplication>
#include <QDebug>

int main(int argc, char *argv[])
{
    QCoreApplication a(argc, argv);
    
    Server server;
    if (!server.listen(QHostAddress::Any, 8888)) {
        qDebug() << "æœåŠ¡ç«¯å¯åŠ¨å¤±è´¥ï¼š" << server.errorString();
        return -1;
    }
    
    qDebug() << "æœåŠ¡ç«¯å·²å¯åŠ¨ï¼Œç›‘å¬ç«¯å£ï¼š8888";
    qDebug() << "ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...";
    
    return a.exec();
}
```

### æ­¥éª¤5ï¼šå®ç°æ‰€æœ‰ä¸šåŠ¡é€»è¾‘å¤„ç†å‡½æ•°

ä½ éœ€è¦å°†å®¢æˆ·ç«¯ä¸­æ‰€æœ‰çš„æ•°æ®åº“æ“ä½œéƒ½ç§»åˆ°æœåŠ¡ç«¯ï¼ŒåŒ…æ‹¬ï¼š

1. **ç”¨æˆ·ç›¸å…³**ï¼š
   - `handleLogin()` - ç™»å½•éªŒè¯
   - `handleRegister()` - ç”¨æˆ·æ³¨å†Œ
   - æ£€æŸ¥ç”¨æˆ·å/èº«ä»½è¯æ˜¯å¦é‡å¤

2. **ç¥¨åŠ¡æŸ¥è¯¢**ï¼š
   - `handleSearchTickets()` - æ ¹æ®å‡ºå‘åœ°ã€ç›®çš„åœ°ã€æ—¥æœŸã€ç±»å‹æŸ¥è¯¢

3. **è®¢å•ç®¡ç†**ï¼š
   - `handleCreateOrder()` - åˆ›å»ºè®¢å•
   - `handleGetOrders()` - è·å–ç”¨æˆ·è®¢å•åˆ—è¡¨
   - `handleCancelOrder()` - å–æ¶ˆè®¢å•

4. **æ”¶è—ç®¡ç†**ï¼š
   - `handleAddFavorite()` - æ·»åŠ æ”¶è—
   - `handleGetFavorites()` - è·å–æ”¶è—åˆ—è¡¨
   - `handleDeleteFavorite()` - åˆ é™¤æ”¶è—

**å®ç°æŠ€å·§**ï¼š
- å°†å®¢æˆ·ç«¯ä¸­æ‰€æœ‰ `QSqlQuery` ç›¸å…³çš„ä»£ç å¤åˆ¶åˆ°æœåŠ¡ç«¯
- å°†æŸ¥è¯¢ç»“æœè½¬æ¢ä¸º JSON æ ¼å¼è¿”å›
- ä¿æŒä¸šåŠ¡é€»è¾‘ä¸å˜ï¼Œåªæ˜¯æ”¹å˜æ•°æ®ä¼ é€’æ–¹å¼

---

## ğŸ’» ç¬¬äºŒéƒ¨åˆ†ï¼šæ”¹é€ å®¢æˆ·ç«¯

### æ­¥éª¤1ï¼šä¿®æ”¹é¡¹ç›®é…ç½®

åœ¨ `Management.pro` ä¸­æ·»åŠ ç½‘ç»œæ¨¡å—ï¼š
```pro
QT += core gui sql widgets network
```

### æ­¥éª¤2ï¼šåˆ›å»ºç½‘ç»œé€šä¿¡ç±»

#### 2.1 åˆ›å»º `networkclient.h`
```cpp
#ifndef NETWORKCLIENT_H
#define NETWORKCLIENT_H

#include <QTcpSocket>
#include <QJsonDocument>
#include <QJsonObject>
#include <QObject>

class NetworkClient : public QObject
{
    Q_OBJECT

public:
    explicit NetworkClient(QObject *parent = nullptr);
    ~NetworkClient();
    
    bool connectToServer(const QString &host = "127.0.0.1", quint16 port = 8888);
    void disconnectFromServer();
    bool isConnected() const;
    
    // å‘é€è¯·æ±‚
    void sendRequest(int msgType, const QJsonObject &data);
    
signals:
    void responseReceived(int msgType, bool success, const QString &message, const QJsonObject &data);
    void connectionStatusChanged(bool connected);
    void errorOccurred(const QString &error);

private slots:
    void onReadyRead();
    void onConnected();
    void onDisconnected();
    void onError(QAbstractSocket::SocketError error);

private:
    QTcpSocket *socket;
    quint32 expectedDataSize;
    QByteArray buffer;
};

#endif // NETWORKCLIENT_H
```

#### 2.2 åˆ›å»º `networkclient.cpp`

**å…³é”®å®ç°**ï¼š
```cpp
void NetworkClient::sendRequest(int msgType, const QJsonObject &data)
{
    if (!socket || socket->state() != QAbstractSocket::ConnectedState) {
        emit errorOccurred("æœªè¿æ¥åˆ°æœåŠ¡å™¨");
        return;
    }
    
    QJsonObject request;
    request["type"] = msgType;
    request["data"] = data;
    
    QJsonDocument doc(request);
    QByteArray jsonData = doc.toJson(QJsonDocument::Compact);
    
    // æ·»åŠ é•¿åº¦å‰ç¼€
    QByteArray packet;
    QDataStream stream(&packet, QIODevice::WriteOnly);
    stream << (quint32)jsonData.size();
    packet.append(jsonData);
    
    socket->write(packet);
    socket->flush();
}

void NetworkClient::onReadyRead()
{
    QDataStream in(socket);
    in.setVersion(QDataStream::Qt_6_0);
    
    while (true) {
        if (expectedDataSize == 0) {
            if (socket->bytesAvailable() < sizeof(quint32)) {
                break;
            }
            in >> expectedDataSize;
        }
        
        if (socket->bytesAvailable() < expectedDataSize) {
            break;
        }
        
        QByteArray jsonData = socket->read(expectedDataSize);
        expectedDataSize = 0;
        
        QJsonParseError error;
        QJsonDocument doc = QJsonDocument::fromJson(jsonData, &error);
        
        if (error.error == QJsonParseError::NoError && doc.isObject()) {
            QJsonObject obj = doc.object();
            int msgType = obj["type"].toInt();
            bool success = obj["success"].toBool();
            QString message = obj["message"].toString();
            QJsonObject data = obj["data"].toObject();
            
            emit responseReceived(msgType, success, message, data);
        }
    }
}
```

### æ­¥éª¤3ï¼šåˆ›å»ºå•ä¾‹ç½‘ç»œå®¢æˆ·ç«¯ç®¡ç†å™¨

åˆ›å»º `networkmanager.h` å’Œ `networkmanager.cpp`ï¼Œæä¾›å…¨å±€è®¿é—®ï¼š

```cpp
// networkmanager.h
#ifndef NETWORKMANAGER_H
#define NETWORKMANAGER_H

#include "networkclient.h"

class NetworkManager : public QObject
{
    Q_OBJECT

public:
    static NetworkManager* instance();
    NetworkClient* client() { return m_client; }
    
    bool connectToServer();
    
private:
    NetworkManager(QObject *parent = nullptr);
    static NetworkManager* m_instance;
    NetworkClient *m_client;
};

#endif // NETWORKMANAGER_H
```

### æ­¥éª¤4ï¼šä¿®æ”¹ `main.cpp` - ç§»é™¤æ•°æ®åº“è¿æ¥

**åˆ é™¤**ï¼š
```cpp
// åˆ é™¤è¿™äº›ä»£ç 
QSqlDatabase dbcon = QSqlDatabase::addDatabase("QODBC");
// ... æ‰€æœ‰æ•°æ®åº“è¿æ¥ä»£ç 
```

**æ·»åŠ **ï¼š
```cpp
#include "networkmanager.h"

int main(int argc, char *argv[])
{
    QApplication a(argc, argv);
    
    // è¿æ¥æœåŠ¡å™¨
    if (!NetworkManager::instance()->connectToServer()) {
        QMessageBox::critical(nullptr, "é”™è¯¯", "æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼");
        return -1;
    }
    
    MainWindow w;
    w.show();
    return a.exec();
}
```

### æ­¥éª¤5ï¼šæ”¹é€ å„ä¸ªåŠŸèƒ½æ¨¡å—

#### 5.1 æ”¹é€ ç™»å½•åŠŸèƒ½ï¼ˆ`MainWindow.cpp`ï¼‰

**åŸæ¥çš„ä»£ç **ï¼ˆéœ€è¦åˆ é™¤ï¼‰ï¼š
```cpp
void MainWindow::on_log_in_clicked()
{
    QString username = ui->Usernamet->text().trimmed();
    QString password = ui->Passwordt->text().trimmed();
    
    ConnectDatabase();  // åˆ é™¤
    QString userid = GetUserID(username, password);  // åˆ é™¤
    
    if (!userid.isEmpty()) {
        // ç™»å½•æˆåŠŸ
    }
}
```

**æ”¹é€ å**ï¼š
```cpp
void MainWindow::on_log_in_clicked()
{
    QString username = ui->Usernamet->text().trimmed();
    QString password = ui->Passwordt->text().trimmed();
    
    if (username.isEmpty() || password.isEmpty()) {
        QMessageBox::warning(this, "æç¤º", "ç”¨æˆ·åæˆ–å¯†ç ä¸èƒ½ä¸ºç©ºï¼");
        return;
    }
    
    NetworkClient *client = NetworkManager::instance()->client();
    
    // è¿æ¥ä¿¡å·
    connect(client, &NetworkClient::responseReceived, 
            this, &MainWindow::onLoginResponse, Qt::UniqueConnection);
    
    // å‘é€ç™»å½•è¯·æ±‚
    QJsonObject data;
    data["username"] = username;
    data["password"] = password;
    client->sendRequest(MSG_LOGIN, data);
}

void MainWindow::onLoginResponse(int msgType, bool success, 
                                 const QString &message, const QJsonObject &data)
{
    if (msgType != MSG_LOGIN_RESPONSE) return;
    
    if (success) {
        QString userID = data["userID"].toString();
        QMessageBox::information(this, "æˆåŠŸ", "ç™»å½•æˆåŠŸ");
        
        Deal *d = new Deal(userID);
        d->setAttribute(Qt::WA_DeleteOnClose);
        d->show();
        this->close();
    } else {
        QMessageBox::warning(this, "å¤±è´¥", message);
    }
}
```

#### 5.2 æ”¹é€ æ³¨å†ŒåŠŸèƒ½ï¼ˆ`sign_in.cpp`ï¼‰

**æ”¹é€ æ€è·¯**ï¼š
1. åˆ é™¤æ‰€æœ‰ `QSqlQuery` ç›¸å…³ä»£ç 
2. ä½¿ç”¨ `NetworkClient` å‘é€æ³¨å†Œè¯·æ±‚
3. åœ¨å“åº”æ§½å‡½æ•°ä¸­å¤„ç†ç»“æœ

#### 5.3 æ”¹é€ ç¥¨åŠ¡æŸ¥è¯¢ï¼ˆ`deal.cpp`ï¼‰

**æ”¹é€  `searchTickets()` å‡½æ•°**ï¼š
```cpp
void Deal::searchTickets()
{
    QString from = ui->lineEdit_from->text().trimmed();
    QString to = ui->lineEdit_to->text().trimmed();
    QDate date = ui->dateEdit->date();
    QString type = ui->comboBox_type->currentText();
    
    NetworkClient *client = NetworkManager::instance()->client();
    
    connect(client, &NetworkClient::responseReceived,
            this, &Deal::onSearchResponse, Qt::UniqueConnection);
    
    QJsonObject data;
    data["from"] = from;
    data["to"] = to;
    data["date"] = date.toString("yyyy-MM-dd");
    data["type"] = type;
    
    client->sendRequest(MSG_SEARCH_TICKETS, data);
}

void Deal::onSearchResponse(int msgType, bool success,
                           const QString &message, const QJsonObject &data)
{
    if (msgType != MSG_SEARCH_RESPONSE) return;
    
    if (!success) {
        QMessageBox::warning(this, "é”™è¯¯", message);
        return;
    }
    
    // è§£æç¥¨åŠ¡åˆ—è¡¨
    QJsonArray tickets = data["tickets"].toArray();
    ui->tableWidget_tickets->setRowCount(0);
    
    for (const QJsonValue &value : tickets) {
        QJsonObject ticket = value.toObject();
        // å¡«å……è¡¨æ ¼...
    }
}
```

#### 5.4 æ”¹é€ è®¢å•ç›¸å…³åŠŸèƒ½

**`order_dialog.cpp`** - åˆ›å»ºè®¢å•ï¼š
- åˆ é™¤æ•°æ®åº“æ’å…¥ä»£ç 
- å‘é€ `MSG_CREATE_ORDER` è¯·æ±‚
- åœ¨å“åº”ä¸­å¤„ç†ç»“æœ

**`single_center.cpp`** - è®¢å•åˆ—è¡¨å’Œå–æ¶ˆè®¢å•ï¼š
- åˆ é™¤ `loadOrders()` ä¸­çš„æ•°æ®åº“æŸ¥è¯¢
- å‘é€ `MSG_GET_ORDERS` è¯·æ±‚è·å–åˆ—è¡¨
- å‘é€ `MSG_CANCEL_ORDER` è¯·æ±‚å–æ¶ˆè®¢å•

### æ­¥éª¤6ï¼šå¤„ç†æ‰€æœ‰æ•°æ®åº“æ“ä½œ

**éœ€è¦æ”¹é€ çš„æ–‡ä»¶æ¸…å•**ï¼š
1. âœ… `main.cpp` - ç§»é™¤æ•°æ®åº“è¿æ¥
2. âœ… `MainWindow.cpp` - ç™»å½•ã€è·å–ç”¨æˆ·ID
3. âœ… `sign_in.cpp` - æ³¨å†Œã€æ£€æŸ¥ç”¨æˆ·å/èº«ä»½è¯
4. âœ… `deal.cpp` - æŸ¥è¯¢ç¥¨åŠ¡ã€æ”¶è—æ“ä½œ
5. âœ… `order_dialog.cpp` - åˆ›å»ºè®¢å•
6. âœ… `single_center.cpp` - è®¢å•åˆ—è¡¨ã€å–æ¶ˆè®¢å•
7. âœ… `favorite_dialog.cpp` - æ”¶è—ç®¡ç†
8. âœ… `userprofile.cpp` - ç”¨æˆ·ä¿¡æ¯ç›¸å…³ï¼ˆå¦‚æœæœ‰æ•°æ®åº“æ“ä½œï¼‰

**æ”¹é€ åŸåˆ™**ï¼š
- æ‰¾åˆ°æ‰€æœ‰ `QSqlQuery`ã€`QSqlDatabase` çš„ä½¿ç”¨
- æ›¿æ¢ä¸º `NetworkClient::sendRequest()`
- æ·»åŠ å“åº”å¤„ç†æ§½å‡½æ•°
- åˆ é™¤æ‰€æœ‰æ•°æ®åº“è¿æ¥ä»£ç 

---

## ğŸ”§ ç¬¬ä¸‰éƒ¨åˆ†ï¼šæµ‹è¯•å’Œè°ƒè¯•

### æ­¥éª¤1ï¼šæµ‹è¯•æœåŠ¡ç«¯

1. **å…ˆè¿è¡ŒæœåŠ¡ç«¯ç¨‹åº**
   - ç¡®ä¿æ•°æ®åº“è¿æ¥æ­£å¸¸
   - æ£€æŸ¥ç«¯å£8888æ˜¯å¦è¢«å ç”¨
   - è§‚å¯Ÿæ§åˆ¶å°è¾“å‡ºï¼Œç¡®è®¤æœåŠ¡ç«¯å¯åŠ¨æˆåŠŸ

2. **æµ‹è¯•æ•°æ®åº“è¿æ¥**
   - åœ¨æœåŠ¡ç«¯ `initDatabase()` ä¸­æ·»åŠ æµ‹è¯•æŸ¥è¯¢
   - ç¡®ä¿èƒ½æ­£å¸¸æ‰§è¡ŒSQLè¯­å¥

### æ­¥éª¤2ï¼šæµ‹è¯•å®¢æˆ·ç«¯è¿æ¥

1. **æµ‹è¯•è¿æ¥åŠŸèƒ½**
   - è¿è¡Œå®¢æˆ·ç«¯
   - æ£€æŸ¥æ˜¯å¦èƒ½è¿æ¥åˆ°æœåŠ¡ç«¯
   - è§‚å¯Ÿç½‘ç»œçŠ¶æ€

2. **æµ‹è¯•ç™»å½•åŠŸèƒ½**
   - è¾“å…¥æ­£ç¡®çš„ç”¨æˆ·åå¯†ç 
   - æ£€æŸ¥æ˜¯å¦èƒ½æ”¶åˆ°å“åº”
   - éªŒè¯ç”¨æˆ·IDæ˜¯å¦æ­£ç¡®è¿”å›

### æ­¥éª¤3ï¼šé€æ­¥æµ‹è¯•å„åŠŸèƒ½

æŒ‰ä»¥ä¸‹é¡ºåºæµ‹è¯•ï¼š
1. ç™»å½•/æ³¨å†Œ
2. æŸ¥è¯¢ç¥¨åŠ¡
3. åˆ›å»ºè®¢å•
4. æŸ¥çœ‹è®¢å•åˆ—è¡¨
5. å–æ¶ˆè®¢å•
6. æ”¶è—åŠŸèƒ½

### æ­¥éª¤4ï¼šé”™è¯¯å¤„ç†

**æ·»åŠ é”™è¯¯å¤„ç†**ï¼š
- ç½‘ç»œæ–­å¼€é‡è¿æœºåˆ¶
- è¶…æ—¶å¤„ç†
- é”™è¯¯æ¶ˆæ¯æç¤º
- æ—¥å¿—è®°å½•

---

## ğŸ“ ç¬¬å››éƒ¨åˆ†ï¼šä¼˜åŒ–å»ºè®®

### 1. æ•°æ®æ ¼å¼ä¼˜åŒ–
- ä½¿ç”¨æ›´ç´§å‡‘çš„JSONæ ¼å¼
- è€ƒè™‘ä½¿ç”¨äºŒè¿›åˆ¶åè®®ï¼ˆProtoBufï¼‰æé«˜æ€§èƒ½

### 2. å®‰å…¨æ€§
- å¯†ç åŠ å¯†ä¼ è¾“ï¼ˆMD5/SHA256ï¼‰
- æ·»åŠ Tokenè®¤è¯æœºåˆ¶
- é˜²æ­¢SQLæ³¨å…¥ï¼ˆæœåŠ¡ç«¯ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼‰

### 3. æ€§èƒ½ä¼˜åŒ–
- è¿æ¥æ± ç®¡ç†
- æ•°æ®ç¼“å­˜
- åˆ†é¡µåŠ è½½

### 4. ä»£ç ç»„ç»‡
- å°†åè®®å®šä¹‰å•ç‹¬æ–‡ä»¶
- åˆ›å»ºç»Ÿä¸€çš„é”™è¯¯ç 
- æ·»åŠ æ—¥å¿—ç³»ç»Ÿ

---

## ğŸ¯ æ”¹é€ æ£€æŸ¥æ¸…å•

### æœåŠ¡ç«¯æ£€æŸ¥é¡¹
- [ ] æœåŠ¡ç«¯é¡¹ç›®åˆ›å»ºå®Œæˆ
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] æ‰€æœ‰æ¶ˆæ¯ç±»å‹å·²å®šä¹‰
- [ ] ç™»å½•åŠŸèƒ½å®ç°
- [ ] æ³¨å†ŒåŠŸèƒ½å®ç°
- [ ] ç¥¨åŠ¡æŸ¥è¯¢å®ç°
- [ ] è®¢å•åˆ›å»ºå®ç°
- [ ] è®¢å•åˆ—è¡¨å®ç°
- [ ] è®¢å•å–æ¶ˆå®ç°
- [ ] æ”¶è—åŠŸèƒ½å®ç°
- [ ] é”™è¯¯å¤„ç†å®Œå–„

### å®¢æˆ·ç«¯æ£€æŸ¥é¡¹
- [ ] ç½‘ç»œæ¨¡å—å·²æ·»åŠ 
- [ ] NetworkClientç±»å®ç°
- [ ] NetworkManagerå•ä¾‹å®ç°
- [ ] main.cppå·²ç§»é™¤æ•°æ®åº“è¿æ¥
- [ ] ç™»å½•åŠŸèƒ½å·²æ”¹é€ 
- [ ] æ³¨å†ŒåŠŸèƒ½å·²æ”¹é€ 
- [ ] ç¥¨åŠ¡æŸ¥è¯¢å·²æ”¹é€ 
- [ ] è®¢å•åˆ›å»ºå·²æ”¹é€ 
- [ ] è®¢å•åˆ—è¡¨å·²æ”¹é€ 
- [ ] è®¢å•å–æ¶ˆå·²æ”¹é€ 
- [ ] æ”¶è—åŠŸèƒ½å·²æ”¹é€ 
- [ ] æ‰€æœ‰æ•°æ®åº“æ“ä½œå·²ç§»é™¤

---

## ğŸš€ å¼€å§‹æ”¹é€ 

**å»ºè®®æ”¹é€ é¡ºåº**ï¼š
1. å…ˆæ­å»ºæœåŠ¡ç«¯æ¡†æ¶ï¼ˆèƒ½å¯åŠ¨ã€èƒ½è¿æ¥æ•°æ®åº“ï¼‰
2. å®ç°æœåŠ¡ç«¯çš„ç™»å½•åŠŸèƒ½
3. æ”¹é€ å®¢æˆ·ç«¯çš„ç™»å½•åŠŸèƒ½ï¼Œæµ‹è¯•é€šä¿¡
4. é€æ­¥å®ç°å…¶ä»–åŠŸèƒ½æ¨¡å—
5. æœ€åå®Œå–„é”™è¯¯å¤„ç†å’Œä¼˜åŒ–

**é‡åˆ°é—®é¢˜æ—¶çš„è°ƒè¯•æ–¹æ³•**ï¼š
1. åœ¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½æ·»åŠ  `qDebug()` è¾“å‡º
2. ä½¿ç”¨WiresharkæŠ“åŒ…æŸ¥çœ‹ç½‘ç»œæ•°æ®
3. æ£€æŸ¥JSONæ ¼å¼æ˜¯å¦æ­£ç¡®
4. éªŒè¯æ•°æ®åº“æŸ¥è¯¢ç»“æœ

ç¥ä½ æ”¹é€ é¡ºåˆ©ï¼ğŸ’ª

