# sender() å‡½æ•°å®Œæ•´å›¾ç¤ºæ–‡æ¡£

## ğŸ¯ æ ¸å¿ƒç­”æ¡ˆ

**`sender()` æ˜¯ Qt æ¡†æ¶ `QObject` ç±»çš„æˆå‘˜å‡½æ•°ï¼Œå®šä¹‰åœ¨ Qt æºä»£ç ä¸­ã€‚**

## ğŸ“¦ ç»§æ‰¿å…³ç³»å›¾

```
QObject (Qtæ¡†æ¶æä¾›çš„åŸºç±»)
  â””â”€ å®šä¹‰äº† sender() å‡½æ•°
      â†‘
QTcpServer (Qtæ¡†æ¶æä¾›çš„TCPæœåŠ¡å™¨ç±»)
  â””â”€ ç»§æ‰¿è‡ª QObject
      â†‘
Server (ä½ çš„ç±»)
  â””â”€ ç»§æ‰¿è‡ª QTcpServer
      â””â”€ å¯ä»¥ä½¿ç”¨ sender() å‡½æ•°ï¼
```

## ğŸ”— ä¿¡å·æ§½è¿æ¥è¿‡ç¨‹

### æ­¥éª¤1ï¼šæ–°å®¢æˆ·ç«¯è¿æ¥

```cpp
void Server::newConnection()
{
    // 1. è·å–æ–°è¿æ¥çš„å®¢æˆ·ç«¯Socket
    QTcpSocket *client = this->nextPendingConnection();
    
    // 2. â­ è¿æ¥ä¿¡å·å’Œæ§½
    connect(client, &QTcpSocket::readyRead,     // ä¿¡å·å‘é€è€…
            this, &Server::readClientData);      // æ§½å‡½æ•°æ¥æ”¶è€…
    
    // Qtæ¡†æ¶ä¼šè®°å½•è¿™ä¸ªè¿æ¥å…³ç³»ï¼š
    // "å½“ client å‘å‡º readyRead ä¿¡å·æ—¶ï¼Œè°ƒç”¨ Server::readClientData"
}
```

### è¿æ¥å…³ç³»ç¤ºæ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        ä¿¡å·æ§½è¿æ¥         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ QTcpSocket  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>  â”‚   Server    â”‚
â”‚  (client)   â”‚    readyRead() ä¿¡å·       â”‚  (this)     â”‚
â”‚             â”‚ <â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚             â”‚
â”‚             â”‚    readClientData() æ§½    â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¡ ä¿¡å·è§¦å‘å’Œæ‰§è¡Œè¿‡ç¨‹

### å®Œæ•´æµç¨‹å›¾ç¤º

```
æ—¶åˆ»1ï¼šå®¢æˆ·ç«¯å‘é€æ•°æ®
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®¢æˆ·ç«¯1    â”‚ å‘é€æ•°æ®
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  QTcpSocket (client1)               â”‚
â”‚  æ£€æµ‹åˆ°æ•°æ®åˆ°è¾¾                     â”‚
â”‚  â””â”€ å‘å‡º readyRead() ä¿¡å·           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ ä¿¡å·å‘å‡º
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Qtæ¡†æ¶çš„ä¿¡å·æ§½ç³»ç»Ÿ                  â”‚
â”‚  â””â”€ æŸ¥æ‰¾è¿æ¥çš„æ§½å‡½æ•°                 â”‚
â”‚     æ‰¾åˆ°ï¼šServer::readClientData()  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â†“ è°ƒç”¨æ§½å‡½æ•°
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Server::readClientData() è¢«è°ƒç”¨    â”‚
â”‚                                     â”‚
â”‚  â­ æ­¤æ—¶ï¼ŒQtæ¡†æ¶å·²ç»è®°å½•äº†ï¼š         â”‚
â”‚     å‘é€è€… = client1 (QTcpSocket*)  â”‚
â”‚                                     â”‚
â”‚  sender() å‡½æ•°è¿”å›ï¼šclient1         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä»£ç æ‰§è¡Œè¿‡ç¨‹

```cpp
// å½“ client1 å‘é€æ•°æ®æ—¶ï¼š

// 1. Qtæ¡†æ¶æ£€æµ‹åˆ°æ•°æ®ï¼Œå‘å‡ºä¿¡å·
client1->readyRead();  // Qtå†…éƒ¨è‡ªåŠ¨è°ƒç”¨

// 2. Qtæ¡†æ¶æŸ¥æ‰¾è¿æ¥çš„æ§½å‡½æ•°
//    æ‰¾åˆ°ï¼šServer::readClientData

// 3. Qtæ¡†æ¶è°ƒç”¨æ§½å‡½æ•°ï¼Œå¹¶è®°å½•å‘é€è€…
this->readClientData();  
// æ­¤æ—¶ Qt å†…éƒ¨è®°å½•ï¼šå½“å‰å‘é€è€… = client1

// 4. åœ¨ readClientData() ä¸­
void Server::readClientData()
{
    // sender() è¿”å› Qt å†…éƒ¨è®°å½•çš„å‘é€è€…
    QTcpSocket *client = qobject_cast<QTcpSocket*>(sender());
    // sender() è¿”å› client1
    // qobject_cast ç¡®ä¿ç±»å‹å®‰å…¨ï¼Œè½¬æ¢ä¸º QTcpSocket*
    
    // ç°åœ¨å¯ä»¥ä½¿ç”¨ client1 è¯»å–æ•°æ®
    QByteArray data = client->readAll();
}
```

## ğŸ” sender() çš„å†…éƒ¨å·¥ä½œåŸç†

### Qtæ¡†æ¶å†…éƒ¨çš„å®ç°ï¼ˆç®€åŒ–ç†è§£ï¼‰

```cpp
// Qtæ¡†æ¶å†…éƒ¨ï¼ˆä¼ªä»£ç ï¼‰

class QObject {
private:
    QObject *m_sender;  // å­˜å‚¨å‘é€è€…

public:
    // å½“ä¿¡å·å‘å‡ºæ—¶
    void emitSignal() {
        // è®°å½•å‘é€è€…
        m_sender = this;  // this = å‘å‡ºä¿¡å·çš„å¯¹è±¡
        
        // è°ƒç”¨è¿æ¥çš„æ§½å‡½æ•°
        connectedSlot->call();
    }
    
    // sender() å‡½æ•°
    QObject* sender() const {
        return m_sender;  // è¿”å›ä¹‹å‰è®°å½•çš„å‘é€è€…
    }
};
```

### å¤šå®¢æˆ·ç«¯åœºæ™¯

```
åœºæ™¯ï¼š3ä¸ªå®¢æˆ·ç«¯åŒæ—¶è¿æ¥

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®¢æˆ·ç«¯1    â”‚ â†’ QTcpSocket *client1
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å®¢æˆ·ç«¯2    â”‚ â†’ QTcpSocket *client2
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å®¢æˆ·ç«¯3    â”‚ â†’ QTcpSocket *client3
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å½“å®¢æˆ·ç«¯1å‘é€æ•°æ®ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  client1 å‘å‡º readyRead() ä¿¡å·      â”‚
â”‚  â†’ Qtæ¡†æ¶è®°å½•ï¼šå‘é€è€… = client1     â”‚
â”‚  â†’ è°ƒç”¨ readClientData()            â”‚
â”‚  â†’ sender() è¿”å› client1            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å½“å®¢æˆ·ç«¯2å‘é€æ•°æ®ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  client2 å‘å‡º readyRead() ä¿¡å·      â”‚
â”‚  â†’ Qtæ¡†æ¶è®°å½•ï¼šå‘é€è€… = client2     â”‚
â”‚  â†’ è°ƒç”¨ readClientData()            â”‚
â”‚  â†’ sender() è¿”å› client2            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®ç‚¹**ï¼šæ¯æ¬¡è°ƒç”¨æ§½å‡½æ•°æ—¶ï¼Œ`sender()` è¿”å›çš„éƒ½æ˜¯**å½“å‰è§¦å‘ä¿¡å·çš„å‘é€è€…**ã€‚

## ğŸ“Š å®Œæ•´ä»£ç ç¤ºä¾‹

### server.h

```cpp
#ifndef SERVER_H
#define SERVER_H

#include <QTcpServer>
#include <QTcpSocket>
#include <QList>

class Server : public QTcpServer
{
    Q_OBJECT  // â­ å¿…é¡»ï¼Œå¯ç”¨å…ƒå¯¹è±¡ç³»ç»Ÿ

public:
    explicit Server(QObject *parent = nullptr);
    
private slots:
    void newConnection();        // æ–°å®¢æˆ·ç«¯è¿æ¥
    void readClientData();       // è¯»å–å®¢æˆ·ç«¯æ•°æ®
    void clientDisconnected();   // å®¢æˆ·ç«¯æ–­å¼€

private:
    QList<QTcpSocket*> clients;  // å®¢æˆ·ç«¯åˆ—è¡¨
};

#endif
```

### server.cppï¼ˆå®Œæ•´å®ç°ï¼‰

```cpp
#include "server.h"
#include <QDebug>

Server::Server(QObject *parent) : QTcpServer(parent)
{
    // è¿æ¥æ–°è¿æ¥ä¿¡å·
    connect(this, &QTcpServer::newConnection,
            this, &Server::newConnection);
}

void Server::newConnection()
{
    // 1. è·å–æ–°è¿æ¥çš„å®¢æˆ·ç«¯
    QTcpSocket *client = this->nextPendingConnection();
    
    // 2. æ·»åŠ åˆ°åˆ—è¡¨
    clients.append(client);
    
    qDebug() << "æ–°å®¢æˆ·ç«¯è¿æ¥ï¼š" << client->peerAddress().toString();
    
    // 3. â­ è¿æ¥ä¿¡å·å’Œæ§½ï¼ˆå…³é”®æ­¥éª¤ï¼‰
    connect(client, &QTcpSocket::readyRead,      // ä¿¡å·
            this, &Server::readClientData);       // æ§½
    
    connect(client, &QTcpSocket::disconnected,   // ä¿¡å·
            this, &Server::clientDisconnected);   // æ§½
    
    // è¿æ¥å…³ç³»å·²å»ºç«‹ï¼š
    // client çš„ readyRead ä¿¡å· â†’ Server::readClientData æ§½
}

void Server::readClientData()
{
    // â­ ä½¿ç”¨ sender() è·å–å‘å‡ºä¿¡å·çš„å®¢æˆ·ç«¯
    QTcpSocket *client = qobject_cast<QTcpSocket*>(sender());
    
    if (!client) {
        qDebug() << "é”™è¯¯ï¼šæ— æ³•è·å–å‘é€è€…";
        return;
    }
    
    qDebug() << "ä»å®¢æˆ·ç«¯" << client->peerAddress().toString() 
             << "æ”¶åˆ°æ•°æ®";
    
    // è¯»å–æ•°æ®
    QByteArray data = client->readAll();
    // ... å¤„ç†æ•°æ® ...
}

void Server::clientDisconnected()
{
    // â­ åŒæ ·ä½¿ç”¨ sender() è·å–æ–­å¼€çš„å®¢æˆ·ç«¯
    QTcpSocket *client = qobject_cast<QTcpSocket*>(sender());
    
    if (client) {
        qDebug() << "å®¢æˆ·ç«¯æ–­å¼€ï¼š" << client->peerAddress().toString();
        clients.removeAll(client);
        client->deleteLater();
    }
}
```

## ğŸ¯ å…³é”®ç†è§£ç‚¹

### 1. sender() æ¥è‡ªå“ªé‡Œï¼Ÿ

```
Qtæ¡†æ¶æºä»£ç ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  QObject ç±»              â”‚
â”‚  class QObject {        â”‚
â”‚      QObject* sender(); â”‚  â† è¿™é‡Œå®šä¹‰
â”‚  }                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä½ çš„ä»£ç ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Server ç±»               â”‚
â”‚  class Server :         â”‚
â”‚      public QTcpServer  â”‚  â† ç»§æ‰¿
â”‚  {                      â”‚
â”‚      // å¯ä»¥ä½¿ç”¨        â”‚
â”‚      // sender()!       â”‚
â”‚  }                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ä¸ºä»€ä¹ˆéœ€è¦ sender()ï¼Ÿ

**é—®é¢˜**ï¼šä¸€ä¸ªæ§½å‡½æ•°å¯èƒ½è¢«å¤šä¸ªå¯¹è±¡è¿æ¥

```
client1 â†’ readyRead() ä¿¡å· â†’ readClientData() æ§½
client2 â†’ readyRead() ä¿¡å· â†’ readClientData() æ§½  
client3 â†’ readyRead() ä¿¡å· â†’ readClientData() æ§½
```

**è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨æ§½å‡½æ•°ä¸­ä½¿ç”¨ `sender()` è¯†åˆ«æ˜¯å“ªä¸ªå¯¹è±¡

```cpp
void Server::readClientData()
{
    QTcpSocket *client = qobject_cast<QTcpSocket*>(sender());
    // å¦‚æœæ˜¯ client1 è§¦å‘çš„ï¼Œsender() è¿”å› client1
    // å¦‚æœæ˜¯ client2 è§¦å‘çš„ï¼Œsender() è¿”å› client2
    // å¦‚æœæ˜¯ client3 è§¦å‘çš„ï¼Œsender() è¿”å› client3
}
```

### 3. ä¿¡å·æ§½è¿æ¥çš„å¿…è¦æ€§

**æ²¡æœ‰è¿æ¥**ï¼šä¿¡å·å‘å‡ºï¼Œä½†æ§½å‡½æ•°ä¸ä¼šè¢«è°ƒç”¨

```cpp
// âŒ é”™è¯¯ï¼šæ²¡æœ‰è¿æ¥ä¿¡å·å’Œæ§½
void Server::newConnection()
{
    QTcpSocket *client = this->nextPendingConnection();
    // ä½†æ˜¯æ²¡æœ‰ connect()ï¼
    // å½“ client å‘å‡º readyRead() ä¿¡å·æ—¶ï¼Œ
    // readClientData() ä¸ä¼šè¢«è°ƒç”¨
}
```

**æœ‰è¿æ¥**ï¼šä¿¡å·å‘å‡ºï¼Œæ§½å‡½æ•°ä¼šè¢«è°ƒç”¨

```cpp
// âœ… æ­£ç¡®ï¼šè¿æ¥ä¿¡å·å’Œæ§½
void Server::newConnection()
{
    QTcpSocket *client = this->nextPendingConnection();
    
    // è¿æ¥ä¿¡å·å’Œæ§½
    connect(client, &QTcpSocket::readyRead,
            this, &Server::readClientData);
    
    // ç°åœ¨å½“ client å‘å‡º readyRead() ä¿¡å·æ—¶ï¼Œ
    // readClientData() ä¼šè¢«è‡ªåŠ¨è°ƒç”¨
}
```

## ğŸ“ æ€»ç»“

### sender() çš„å®Œæ•´ä¿¡æ¯

1. **å®šä¹‰ä½ç½®**ï¼šQt æ¡†æ¶çš„ `QObject` ç±»
2. **ä½œç”¨**ï¼šè¿”å›å‘å‡ºä¿¡å·çš„å¯¹è±¡çš„æŒ‡é’ˆ
3. **ä½¿ç”¨åœºæ™¯**ï¼šåœ¨æ§½å‡½æ•°ä¸­ï¼Œéœ€è¦çŸ¥é“æ˜¯å“ªä¸ªå¯¹è±¡å‘å‡ºçš„ä¿¡å·
4. **ç»§æ‰¿è·¯å¾„**ï¼š`QObject` â†’ `QTcpServer` â†’ `Server`
5. **å·¥ä½œæ–¹å¼**ï¼šQt æ¡†æ¶åœ¨è°ƒç”¨æ§½å‡½æ•°å‰è®°å½•å‘é€è€…ï¼Œ`sender()` è¿”å›è¿™ä¸ªè®°å½•

### å®Œæ•´å·¥ä½œæµç¨‹

```
1. å®¢æˆ·ç«¯è¿æ¥
   â†“
2. newConnection() è¢«è°ƒç”¨
   â†“
3. åˆ›å»º QTcpSocket å¯¹è±¡
   â†“
4. connect() è¿æ¥ä¿¡å·å’Œæ§½
   â†“
5. å®¢æˆ·ç«¯å‘é€æ•°æ®
   â†“
6. QTcpSocket å‘å‡º readyRead() ä¿¡å·
   â†“
7. Qtæ¡†æ¶è°ƒç”¨ readClientData() æ§½
   â†“
8. sender() è¿”å›å‘å‡ºä¿¡å·çš„ QTcpSocket å¯¹è±¡
   â†“
9. å¤„ç†æ•°æ®
```

